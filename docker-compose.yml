services:
  api:
    build:
      context: .
      dockerfile: eCommerce/Dockerfile
    ports:
      - "8080:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      ConnectionStrings__PgConnString: "Host=host.docker.internal;Port=5432;Database=ecommerce;User Id=postgres;Password=admin;"
      JWT__SecretKey: "${JWT_SECRET_KEY:?Set JWT_SECRET_KEY in .env}"
      JWT__Issuer: "${JWT_ISSUER:-ecommerce-app}"
      JWT__Audience: "${JWT_AUDIENCE:-ecommerce-app}"
      Stripe__SecretKey: "${STRIPE_SECRET_KEY:?Set STRIPE_SECRET_KEY in .env}"
      Stripe__WebhookSecret: "${STRIPE_WEBHOOK_SECRET:?Set STRIPE_WEBHOOK_SECRET in .env}"
      Stripe__SuccessUrl: "http://localhost:3000/buyer/orders"
      Stripe__CancelUrl: "http://localhost:3000/buyer/cart"

  frontend:
    build:
      context: ecommerce-frontend
      args:
        VITE_API_URL: "http://localhost:8080/"
    ports:
      - "3000:3000"
    depends_on:
      - api
